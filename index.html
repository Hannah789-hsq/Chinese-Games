<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>AI Games ✨ · Jelly Galaxy</title>
<meta name="description" content="AI Games ✨ · Where play refines minds.">
<style>
  :root{
    /* Jelly Galaxy 主色（无粉色） */
    --bg:#0c0b16;
    --surface:#121226;
    --ink:#f7fbff;
    --muted:#cfe2ff;
    --line:#27315d;

    --violet:#8B5CF6;
    --mint:#10B981;
    --sky:#0EA5E9;
    --amber:#F59E0B;

    /* 赛博外框与中框颜色（蓝/青/紫） */
    --cy-line: rgba(150,190,255,.35);
    --cy-line-strong: rgba(168,205,255,.55);
    --cy-glow-v: rgba(139,92,246,.45);
    --cy-glow-s: rgba(14,165,233,.38);

    --radius:18px;
  }

  *{box-sizing:border-box}
  body{
    margin:0; color:var(--ink);
    background:
      radial-gradient(1000px 600px at 80% -10%, rgba(139,92,246,.22) 0%, transparent 60%),
      radial-gradient(900px 500px at -10% 10%, rgba(14,165,233,.2) 0%, transparent 60%),
      linear-gradient(180deg,#12122a,#0c0b16);
    font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans SC','PingFang SC',sans-serif;
    -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
  }
  a{color:inherit; text-decoration:none}
  .wrap{max-width:1120px; margin:0 auto; padding:0 16px}

  /* Header */
  .header{
    position:sticky; top:0; z-index:10;
    background:rgba(15,15,34,.66);
    backdrop-filter:saturate(1.2) blur(10px);
    border-bottom:1px solid var(--line);
  }
  .nav{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0; flex-wrap:wrap}
  .brand{display:flex; align-items:center; gap:10px}
  .seal{width:36px; height:36px; border-radius:8px; background:#d43c2f; display:grid; place-items:center; color:#fff; box-shadow:0 8px 18px rgba(212,60,47,.35)}
  .seal svg{width:72%; height:72%}
  .title{margin:0; font-weight:900; letter-spacing:.2px}
  .sub{color:var(--muted); font-size:13px; margin-top:2px}
  .pills{display:flex; gap:8px; background:#121a3a; border:1px solid var(--line); padding:6px; border-radius:999px}
  .pill{appearance:none; border:0; background:transparent; padding:7px 12px; border-radius:999px; cursor:pointer; font-weight:900; color:#e9f2ff}
  .pill.active{background:#172156; box-shadow:0 0 0 2px #22306a inset}

  /* 搜索 */
  .search{display:flex; align-items:center; gap:8px; padding:8px 12px; min-width:220px; background:#121a3a; border:1px solid var(--line); border-radius:12px; color:#d8e6ff}
  .search input{flex:1; border:0; outline:0; background:transparent; font-size:14px; color:#eef6ff}

  /* Hero */
  .hero{position:relative; padding:28px 0 10px}
  .box{
    position:relative; overflow:hidden;
    border:1px solid var(--line); border-radius:22px; padding:24px 18px;
    background:
      radial-gradient(800px 400px at 10% -10%, rgba(139,92,246,.25), transparent 60%),
      radial-gradient(900px 500px at 90% 10%, rgba(16,185,129,.25), transparent 60%),
      linear-gradient(180deg,#15153a,#11112a);
  }
  .confetti{position:absolute; inset:0; z-index:0}
  .content{position:relative; z-index:1}
  .h1{margin:0; font-size:30px; font-weight:900; text-shadow:0 0 16px rgba(139,92,246,.25), 0 0 28px rgba(14,165,233,.18)}
  .lead{margin:6px 0 0; color:#dfeaff}
  .pair{margin:2px 0 0; color:#cfe2ff; font-size:14px}
  .cta{display:flex; gap:10px; margin-top:10px; flex-wrap:wrap}
  .btn{
    position:relative; display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:14px;
    font-weight:900; border:0; cursor:pointer; overflow:hidden;
    color:#0b1216; background:linear-gradient(180deg,#98f7d8,var(--mint));
    box-shadow:0 10px 24px rgba(16,185,129,.28), 0 0 0 2px rgba(16,185,129,.2) inset;
  }
  .btn.secondary{
    color:#0b0f18; background:linear-gradient(180deg,#b9d6ff,var(--sky));
    box-shadow:0 10px 24px rgba(14,165,233,.28), 0 0 0 2px rgba(14,165,233,.2) inset;
  }
  .btn .shine{position:absolute; top:0; left:-120%; width:120%; height:100%; transform:skewX(-20deg); background:linear-gradient(90deg, transparent, rgba(255,255,255,.7), transparent)}
  .btn:hover .shine{animation:shine 1s ease}
  @keyframes shine{ from{left:-120%} to{left:120%} }

  /* Sections */
  section{padding:14px 0 20px}
  .sec-head{display:flex; align-items:flex-end; justify-content:space-between; margin-bottom:10px}
  .sec-title{font-size:18px; font-weight:900; margin:0}

  .grid{display:grid; gap:14px; grid-template-columns:repeat(auto-fill,minmax(230px,1fr))}

  /* 卡片：外层赛博荧光连续描边（无粉色，无虚线） */
  .card{
    position:relative; display:flex; flex-direction:column; gap:10px; padding:14px; border-radius:20px;
    background:linear-gradient(180deg,#16163e,#12122a);
    border:1px solid var(--cy-line);
    box-shadow:
      0 0 0 1px rgba(142,170,255,.12) inset,
      0 10px 22px rgba(14,165,233,.12),
      0 0 24px rgba(139,92,246,.08);
    transform:translateZ(0);
    transition:transform .2s ease, box-shadow .35s ease, border-color .35s ease;
  }

  /* 外层荧光呼吸：hover/focus 才启用；移动端默认静态 */
  @media (hover:hover){
    .card:hover, .card:focus-within{
      animation:card-breathe 1.2s ease-in-out infinite;
      border-color:var(--cy-line-strong);
      box-shadow:
        0 0 0 1px rgba(168,205,255,.22) inset,
        0 12px 26px rgba(14,165,233,.18),
        0 0 32px rgba(139,92,246,.16);
      transform:translateY(-2px);
    }
  }
  @keyframes card-breathe{
    0%,100%{ box-shadow:
      0 0 0 1px rgba(168,205,255,.18) inset,
      0 10px 22px rgba(14,165,233,.12),
      0 0 24px rgba(139,92,246,.10); }
    50%{ box-shadow:
      0 0 0 1px rgba(168,205,255,.28) inset,
      0 14px 28px rgba(14,165,233,.22),
      0 0 42px rgba(139,92,246,.22); }
  }

  .thumb{width:100%; aspect-ratio:16/9; border-radius:16px; overflow:hidden; background:#0b1430}
  .thumb canvas{width:100%; height:100%; display:block}

  .name{font-weight:900; letter-spacing:.2px}
  .desc{color:#dfe7ff; font-size:14px}
  .meta{display:flex; align-items:center; justify-content:space-between}
  .tag{font-size:12px; padding:2px 8px; border-radius:999px; background:#121f4a; border:1px solid #263a8a; color:#e9f2ff; margin-right:6px}
  .go{display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border-radius:12px; font-weight:800; color:#0b1216; background:linear-gradient(180deg,#98f7d8,var(--mint)); border:0}

  /* NEW 徽标：提升层级，防遮挡；并换成薄荷青荧光风格 */
  .badge{
    position:absolute; top:10px; left:10px;
    z-index:100;           /* 确保盖住中框伪元素与卡片阴影 */
    isolation:isolate;     /* 避免被父级混合/滤镜影响 */
    pointer-events:none;   /* 鼠标穿透 */
    font-size:12px; padding:3px 7px; border-radius:999px; font-weight:800;
    color:#05221a;
    background:linear-gradient(180deg,#c2ffe9,#36d8b0);
    box-shadow:0 6px 16px rgba(54,216,176,.38), 0 0 0 1px rgba(170,255,230,.6) inset;
  }

  footer{color:#cfe2ff; font-size:12px; text-align:center; padding:26px 0}

  /* 方案 A：中框赛博角括号 + 扫描线（无粉色） */
  .inner{
    position:relative; height:100%; border-radius:16px; overflow:hidden;
    background:#0b132b;
    border:1px solid rgba(142,170,255,.25);
    box-shadow:inset 0 0 0 1px rgba(142,170,255,.2);
  }
  /* 扫描线 */
  .inner::before{
    content:""; position:absolute; inset:0; pointer-events:none; opacity:.35; mix-blend-mode:overlay; z-index:1;
    background:repeating-linear-gradient(to bottom,
      rgba(255,255,255,.06) 0px,
      rgba(255,255,255,.06) 1px,
      transparent 2px,
      transparent 5px);
    transform:translateY(-20px);
    animation:scan 6s linear infinite;
  }
  @keyframes scan{ to{ transform:translateY(20px) } }

  /* 角括号 */
  .inner::after{
    content:""; position:absolute; inset:8px; border-radius:12px; pointer-events:none; z-index:1;
    background:
      linear-gradient(90deg, rgba(139,92,246,.9), rgba(14,165,233,.9)) top left/18px 2px no-repeat,
      linear-gradient(180deg, rgba(139,92,246,.9), rgba(14,165,233,.9)) top left/2px 18px no-repeat,
      linear-gradient(90deg, rgba(139,92,246,.9), rgba(14,165,233,.9)) top right/18px 2px no-repeat,
      linear-gradient(180deg, rgba(139,92,246,.9), rgba(14,165,233,.9)) top right/2px 18px no-repeat,
      linear-gradient(90deg, rgba(139,92,246,.9), rgba(14,165,233,.9)) bottom left/18px 2px no-repeat,
      linear-gradient(180deg, rgba(139,92,246,.9), rgba(14,165,233,.9)) bottom left/2px 18px no-repeat,
      linear-gradient(90deg, rgba(139,92,246,.9), rgba(14,165,233,.9)) bottom right/18px 2px no-repeat,
      linear-gradient(180deg, rgba(139,92,246,.9), rgba(14,165,233,.9)) bottom right/2px 18px no-repeat;
    filter:drop-shadow(0 0 8px var(--cy-glow-v)) drop-shadow(0 0 12px var(--cy-glow-s));
  }
  /* 同步强化中框发光 */
  @media (hover:hover){
    .card:hover .inner{
      border-color:rgba(142,170,255,.4);
      box-shadow:inset 0 0 0 1px rgba(142,170,255,.28), 0 0 18px rgba(14,165,233,.14);
    }
  }

  /* 小屏适配 */
  @media (max-width:460px){ .search{min-width:0; flex:1} .lead{font-size:14px} }
</style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="wrap">
      <div class="nav">
        <div class="brand">
          <div class="seal" aria-hidden="true">
            <svg viewBox="0 0 100 100" role="img" aria-label="琢玉印章">
              <rect x="6" y="6" width="88" height="88" rx="18" ry="18" fill="none" stroke="rgba(255,255,255,.55)" stroke-width="4"/>
              <g fill="#fff" font-family="'STKaiti','KaiTi','Noto Serif SC',serif" font-weight="700">
                <text x="50" y="40" font-size="36" text-anchor="middle" dominant-baseline="middle">琢</text>
                <text x="50" y="72" font-size="36" text-anchor="middle" dominant-baseline="middle">玉</text>
              </g>
            </svg>
          </div>
          <div>
            <p class="title">AI Games ✨</p>
            <div class="sub">Created by Hannah</div>
          </div>
        </div>
        <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap">
          <div class="pills" role="tablist">
            <button class="pill active" data-jump="#learn">学习类</button>
            <button class="pill" data-jump="#test">测试类</button>
          </div>
          <label class="search" aria-label="搜索游戏">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="#bcd3ff" aria-hidden="true"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79L20 21.5 21.5 20 15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            <input id="q" type="search" placeholder="搜索：名称 / 简介 / 标签">
          </label>
        </div>
      </div>
    </div>
  </div>

  <!-- Hero -->
  <div class="wrap hero">
    <div class="box">
      <canvas class="confetti" aria-hidden="true"></canvas>
      <div class="content">
        <h1 class="h1">Beyond the Game</h1>
        <p class="lead">Where play refines minds.</p>
        <p class="pair">游以砺思，学以致远。</p>
        <div class="cta">
          <a class="btn" href="#learn"><span>开始学习</span><span class="shine"></span></a>
          <a class="btn secondary" href="#test"><span>立即自测</span><span class="shine"></span></a>
        </div>
      </div>
    </div>
  </div>

  <!-- Sections -->
  <div class="wrap">
    <section id="learn">
      <div class="sec-head">
        <h2 class="sec-title">学习类</h2>
        <div class="sub">循序渐进 · 以玩促学</div>
      </div>
      <div id="grid-learn" class="grid"></div>
    </section>

    <section id="test">
      <div class="sec-head">
        <h2 class="sec-title">测试类</h2>
        <div class="sub">快速测验 · 即刻反馈</div>
      </div>
      <div id="grid-test" class="grid"></div>
    </section>
  </div>

  <footer>© <span id="year"></span> AI Games · Created by Hannah</footer>

<script>
  // ========= 数据 =========
  const GAMES = [
    {id:'weijinresou', group:'learn', name:'魏晋热搜', desc:'世说新语，清谈、个人观点与表达。', url:'./games/weijinresou/', tags:['古文','观点','拓展积累'], badges:['NEW']},
    {id:'loushi', group:'learn', name:'陋室雅集', desc:'陋室铭，古人聊天。', url:'./games/loushi/', tags:['古文','对话式','闯关'], badges:['NEW']},
    {id:'mulan', group:'learn', name:'木兰从军记', desc:'跟着木兰闯关。', url:'./games/mulan/', tags:['史诗','节奏','填空']},
    {id:'poememoji', group:'learn', name:'意Emoji', desc:'用表情解读诗句意象。', url:'./games/poememoji/', tags:['诗词','表情','联想']},
    {id:'silianshuo', group:'learn', name:'爱莲说', desc:'复习巩固、托物言志。', url:'./games/silianshuo/', tags:['名篇','归纳','词汇']},
    {id:'typespark', group:'test', name:'TypeSpark', desc:'MBTI+九型人格。', url:'./games/typespark/', tags:['人格','MBTI','九型']},
    {id:'literaturemaster', group:'test', name:'文学大师', desc:'你是哪位文学大师？', url:'./games/literaturemaster/', tags:['常识','速测','匹配']},
    {id:'lotus', group:'test', name:'草木有本心', desc:'你是哪种传统植物？', url:'./games/lotus/', tags:['植物','象征','趣味']}
  ];
  const $ = s=>document.querySelector(s);
  const grids={learn:$('#grid-learn'), test:$('#grid-test')};
  document.getElementById('year').textContent=new Date().getFullYear();

  // ========= 渲染卡片 =========
  function render(){
    ['learn','test'].forEach(k=>grids[k].innerHTML='');
    GAMES.forEach((g)=>{
      const el=document.createElement('article');
      el.className='card';
      el.innerHTML=`
        ${g.badges?.includes('NEW')?'<div class="badge">NEW</div>':''}
        <a class="thumb" href="${g.url}" aria-label="打开 ${g.name}">
          <div class="inner">
            <canvas data-id="${g.id}" aria-hidden="true"></canvas>
          </div>
        </a>
        <div class="name">${g.name}</div>
        <div class="desc">${g.desc}</div>
        <div class="meta">
          <div>${(g.tags||[]).slice(0,3).map(t=>`<span class="tag">${t}</span>`).join('')}</div>
          <a class="go" href="${g.url}">开始</a>
        </div>`;
      grids[g.group].appendChild(el);
      drawCover(el.querySelector('canvas'), g.id);
    });
  }

  // ========= 画封面：Jelly Galaxy 轻量插画 =========
  const jelly = { bg1:'#15153a', bg2:'#11112a', violet:'#8B5CF6', mint:'#10B981', sky:'#0EA5E9', amber:'#F59E0B' };

  function hexA(hex,a){
    const v=hex.replace('#',''); const n=parseInt(v,16);
    const r=(n>>16)&255, g=(n>>8)&255, b=n&255;
    return `rgba(${r},${g},${b},${a})`;
  }

  function drawCover(canvas,id){
    const dpr = Math.min(2, window.devicePixelRatio||1);
    const w=800, h=450;
    canvas.width=w*dpr; canvas.height=h*dpr; canvas.style.width='100%'; canvas.style.height='100%';
    const ctx=canvas.getContext('2d'); ctx.setTransform(dpr,0,0,dpr,0,0);

    const painters = {
      loushi: paintLoushi,
      mulan: paintMulan,
      poememoji: paintPoememoji,
      silianshuo: paintAilian,
      typespark: paintTypeSpark,
      literaturemaster: paintLiterature,
      lotus: paintLotus
    };
    (painters[id]||paintGeneric)(ctx,w,h);

    // 悬停动画（轻量）
    let raf, t=0, running=false;
    const parent = canvas.closest('.thumb');
    function loop(){ raf=requestAnimationFrame(loop); t+=1; (animators[id]||(()=>{}))(ctx,w,h,t); }
    parent.addEventListener('mouseenter', ()=>{ if(!running){ running=true; loop(); } });
    parent.addEventListener('mouseleave', ()=>{ running=false; cancelAnimationFrame(raf); (painters[id]||paintGeneric)(ctx,w,h); });
  }

  function jellyBack(ctx,w,h){
    const g=ctx.createLinearGradient(0,0,w,h); g.addColorStop(0,jelly.bg1); g.addColorStop(1,jelly.bg2);
    ctx.fillStyle=g; ctx.fillRect(0,0,w,h);
    ctx.globalAlpha=.16; ctx.fillStyle='#e9f5ff';
    for(let i=0;i<110;i++){ ctx.fillRect(Math.random()*w, Math.random()*h, 1, 1); }
    ctx.globalAlpha=1;
  }
  function roundedRect(ctx,x,y,w,h,r,fill,stroke){
    ctx.beginPath(); ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    if(fill) ctx.fill(); if(stroke) ctx.stroke();
  }
  function emoji(ctx,x,y,ch,size){
    ctx.font=`800 ${size}px "Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",system-ui`;
    ctx.textAlign='center'; ctx.fillStyle='#eef6ff'; ctx.fillText(ch,x,y);
  }

  // 具体封面
  function paintLoushi(ctx,w,h){
    jellyBack(ctx,w,h);
    const pad=24, blockH=h*0.62;
    const g=ctx.createLinearGradient(0,pad,0,pad+blockH);
    g.addColorStop(0,'#161a44'); g.addColorStop(1,'#12163a');
    ctx.fillStyle=g; roundedRect(ctx,pad,pad,w-2*pad,blockH,18,true,false);
    for(let i=0;i<150;i++){
      ctx.fillStyle=`rgba(245,158,11,${0.28+Math.random()*0.45})`;
      ctx.fillRect(pad+Math.random()*(w-2*pad), pad+Math.random()*blockH, 1.5, 1.5);
    }
    drawScroll(ctx,w*0.5,h*0.42,120,48);
  }
  function drawScroll(ctx,cx,cy,w,h){
    const r=10;
    ctx.fillStyle='#e3d6bf'; roundedRect(ctx,cx-w/2,cy-h/2,w,h,r,true,false);
    ctx.fillStyle='#ccb893'; ctx.fillRect(cx-w/2,cy-h/2, w, 6);
    ctx.fillRect(cx-w/2,cy+h/2-6, w, 6);
    ctx.fillStyle='#9a7a4a';
    ctx.beginPath(); ctx.arc(cx-w/2, cy-h/2, 8, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(cx+w/2, cy+h/2, 8, 0, Math.PI*2); ctx.fill();
  }

  function paintMulan(ctx,w,h){
    jellyBack(ctx,w,h); mountains(ctx,w,h); banner(ctx,w*0.78,h*0.28,120); bow(ctx,w*0.5,h*0.54,120);
  }
  function mountains(ctx,w,h){
    const layers=[{y:0.75,color:'#1a1c4a'},{y:0.65,color:'#1f2560'},{y:0.58,color:'#233072'}];
    layers.forEach(L=>{
      ctx.fillStyle=L.color; ctx.beginPath();
      ctx.moveTo(0,h*L.y);
      for(let x=0;x<=w;x+=40){ const y=h*L.y - Math.sin((x+w*0.3)*0.004)*20 - (Math.random()*6); ctx.lineTo(x,y); }
      ctx.lineTo(w,h); ctx.lineTo(0,h); ctx.closePath(); ctx.fill();
    });
  }
  function banner(ctx,x,y,len){
    ctx.save(); ctx.translate(x,y);
    ctx.fillStyle=hexA('#8B5CF6',.9);
    ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(len,10); ctx.lineTo(len-18,28); ctx.lineTo(0,18); ctx.closePath(); ctx.fill();
    ctx.restore();
  }
  function bow(ctx,x,y,w){
    ctx.save(); ctx.translate(x,y);
    ctx.strokeStyle='#cfe2ff'; ctx.lineWidth=6; ctx.beginPath(); ctx.moveTo(-w/2,0); ctx.quadraticCurveTo(0,-50,w/2,0); ctx.stroke();
    ctx.strokeStyle='#e9f2ff'; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(-w/2,0); ctx.lineTo(w/2,0); ctx.stroke();
    ctx.restore();
  }

  function paintPoememoji(ctx,w,h){
    jellyBack(ctx,w,h);
    for(let i=0;i<16;i++){
      const x=Math.random()*w, y=Math.random()*h, r=20+Math.random()*70;
      const c=[jelly.violet, jelly.mint, jelly.sky][i%3];
      const g=ctx.createRadialGradient(x,y,1,x,y,r);
      g.addColorStop(0, hexA(c,.35)); g.addColorStop(1, hexA(c,0));
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
    }
    emoji(ctx,w/2,h/2+16,'😊',72);
  }

  function paintAilian(ctx,w,h){
    jellyBack(ctx,w,h);
    ctx.strokeStyle='rgba(14,165,233,.45)'; ctx.lineWidth=2;
    for(let i=0;i<6;i++){ ripple(ctx,w*0.7,h*0.6,60+i*22); }
    for(let i=0;i<7;i++){ petal(ctx,w*0.7,h*0.6,60+i*5,i*(Math.PI*2/7), jelly.sky); }
    emoji(ctx,w/2,h/2+18,'🪷',70);
  }
  function ripple(ctx,cx,cy,r,stroke='rgba(14,165,233,.55)'){
    ctx.strokeStyle=stroke; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.stroke();
  }
  function petal(ctx,cx,cy,r,rot,colorHex){
    ctx.save(); ctx.translate(cx,cy); ctx.rotate(rot);
    const g=ctx.createRadialGradient(0,0,0,0,0,r);
    g.addColorStop(0, hexA(colorHex,.6)); g.addColorStop(1, hexA(colorHex,0));
    ctx.fillStyle=g; ctx.beginPath();
    ctx.moveTo(0,0);
    ctx.quadraticCurveTo(r*0.9,-r*0.4,0,-r);
    ctx.quadraticCurveTo(-r*0.9,-r*0.4,0,0);
    ctx.closePath(); ctx.fill(); ctx.restore();
  }

  function paintTypeSpark(ctx,w,h){
    jellyBack(ctx,w,h); keycaps(ctx,w,h); wave(ctx, h*0.7); emoji(ctx,w/2,h/2+16,'⌨️',72);
  }
  function keycaps(ctx,w,h){
    const cols=10, rows=4, pad=24;
    const cellW=(w-2*pad)/cols, cellH=(h*0.45)/rows;
    for(let r=0;r<rows;r++){
      for(let c=0;c<cols;c++){
        const x=pad+c*cellW, y=h*0.45 + r*cellH;
        ctx.fillStyle='#101a4c'; roundedRect(ctx,x+2,y+2,cellW-6,cellH-6,6,true,false);
        ctx.strokeStyle='#1f2e76'; ctx.strokeRect(x+2,y+2,cellW-6,cellH-6);
      }
    }
  }
  function wave(ctx,y,t=0,color='rgba(14,165,233,.75)'){
    ctx.save(); ctx.globalCompositeOperation='lighter';
    ctx.strokeStyle=color; ctx.lineWidth=2;
    const W = ctx.canvas.width/(window.devicePixelRatio||1);
    ctx.beginPath();
    for(let x=40;x<=W-40;x+=8){
      const yy = y + Math.sin((x*0.06)+(t*0.12))*8;
      if(x===40) ctx.moveTo(x,yy); else ctx.lineTo(x,yy);
    }
    ctx.stroke(); ctx.restore();
  }

  function paintLiterature(ctx,w,h){
    jellyBack(ctx,w,h); pageFold(ctx,w,h); feather(ctx,w*0.72,h*0.45,140); goldDust(ctx,w,h); emoji(ctx,w/2,h/2+16,'🪶',72);
  }
  function pageFold(ctx,w,h){
    const g=ctx.createLinearGradient(0,0,0,h);
    g.addColorStop(0,'#16163e'); g.addColorStop(1,'#12122a');
    ctx.fillStyle=g; ctx.fillRect(w*0.1,h*0.15,w*0.8,h*0.5);
    ctx.strokeStyle='#243078'; ctx.lineWidth=2;
    for(let i=0;i<6;i++){
      ctx.beginPath(); ctx.moveTo(w*0.1,h*(0.2+i*0.06));
      ctx.lineTo(w*0.9,h*(0.18+i*0.06)); ctx.stroke();
    }
  }
  function feather(ctx,x,y,len){
    ctx.save(); ctx.translate(x,y);
    ctx.strokeStyle='#bfe6ff'; ctx.lineWidth=3;
    ctx.beginPath(); ctx.moveTo(-len/2,0); ctx.quadraticCurveTo(0,-40,len/2,0); ctx.stroke();
    ctx.strokeStyle='#a7dbff'; ctx.lineWidth=1.5;
    for(let i=-5;i<=5;i++){
      ctx.beginPath(); ctx.moveTo(i*12, -Math.abs(i)*3);
      ctx.lineTo(i*12+ (i<0?-18:18), Math.abs(i)*4);
      ctx.stroke();
    }
    ctx.restore();
  }
  function goldDust(ctx,w,h,alpha=0.3){
    for(let i=0;i<60;i++){
      ctx.fillStyle=`rgba(245,158,11,${alpha})`;
      ctx.fillRect(Math.random()*w, Math.random()*h*0.6, 1.5, 1.5);
    }
  }
  function sparkleSweep(ctx,w,h,t){
    const x = (t*3)%(w+200)-100;
    const grad=ctx.createLinearGradient(x-80,0,x+80,0);
    grad.addColorStop(0,'rgba(255,255,255,0)');
    grad.addColorStop(0.5,'rgba(255,255,255,.12)');
    grad.addColorStop(1,'rgba(255,255,255,0)');
    ctx.fillStyle=grad; ctx.fillRect(0,0,w,h);
  }

  function paintLotus(ctx,w,h){
    jellyBack(ctx,w,h); leafVeins(ctx,w,h); pollen(ctx,w,h); emoji(ctx,w/2,h/2+16,'🌿',72);
  }
  function leafVeins(ctx,w,h){
    ctx.strokeStyle='rgba(16,185,129,.45)'; ctx.lineWidth=1.5;
    const cx=w*0.3, cy=h*0.65;
    for(let a=0;a<Math.PI; a+=Math.PI/14){
      ctx.beginPath(); ctx.moveTo(cx,cy);
      ctx.quadraticCurveTo(cx+Math.cos(a)*140, cy-80, cx+Math.cos(a)*260, cy+Math.sin(a)*60);
      ctx.stroke();
    }
  }
  function pollen(ctx,w,h,alpha=.25,t=0){
    for(let i=0;i<120;i++){
      const x=(i*37 + (t||0))%w, y=(i*53 + Math.sin((t||0)*0.03+i)*14 + h)%h;
      ctx.fillStyle=`rgba(160,255,210,${alpha})`; ctx.fillRect(x,y,1.2,1.2);
    }
  }

  // 动画器
  const animators = {
    loushi(ctx,w,h,t){ if(t%2) return; goldDust(ctx,w,h,0.25); },
    mulan(ctx,w,h,t){ wave(ctx, h*0.35, t, 'rgba(139,92,246,.7)'); },
    poememoji(ctx,w,h,t){ floatBubbles(ctx,w,h,t); },
    silianshuo(ctx,w,h,t){ ripple(ctx,w*0.7,h*0.6,60+Math.sin(t*0.05)*6,'rgba(14,165,233,.55)'); },
    typespark(ctx,w,h,t){ wave(ctx,h*0.7,t, 'rgba(14,165,233,.75)'); },
    literaturemaster(ctx,w,h,t){ sparkleSweep(ctx,w,h,t); },
    lotus(ctx,w,h,t){ pollen(ctx,w,h,0.35,t); }
  };
  function floatBubbles(ctx,w,h,t){
    for(let i=0;i<8;i++){
      const r=30+ (i%5)*10;
      const x=(i*97 + (t*2))%w;
      const y=(i*73 + Math.sin(t*0.05+i)*30 + h)%h;
      const g=ctx.createRadialGradient(x,y,1,x,y,r);
      g.addColorStop(0, hexA('#0EA5E9',.35));
      g.addColorStop(1, hexA('#0EA5E9',0));
      ctx.fillStyle=g; ctx.beginPath(); ctx.arc(x,y,r,0,Math.PI*2); ctx.fill();
    }
  }

  // Hero 星云微粒
  const cvs=document.querySelector('.confetti'); const hctx=cvs.getContext('2d');
  let blobs=[];
  function resizeHero(){
    const r=Math.min(2, window.devicePixelRatio||1);
    cvs.width=cvs.clientWidth*r; cvs.height=cvs.clientHeight*r; hctx.setTransform(r,0,0,r,0,0);
    blobs = Array.from({length:18}, ()=>({
      x: Math.random()*cvs.clientWidth,
      y: Math.random()*cvs.clientHeight,
      r: 40+Math.random()*120,
      c: [hexA('#8B5CF6',.35),hexA('#10B981',.35),hexA('#0EA5E9',.35)][Math.floor(Math.random()*3)],
      vx: (Math.random()-.5)*0.3,
      vy: (Math.random()-.5)*0.3
    }));
  }
  function tick(){
    hctx.clearRect(0,0,cvs.clientWidth,cvs.clientHeight);
    blobs.forEach(b=>{
      b.x += b.vx; b.y += b.vy;
      if(b.x<-100) b.x=cvs.clientWidth+100; if(b.x>cvs.clientWidth+100) b.x=-100;
      if(b.y<-100) b.y=cvs.clientHeight+100; if(b.y>cvs.clientHeight+100) b.y=-100;
      const g=hctx.createRadialGradient(b.x,b.y,1,b.x,b.y,b.r);
      const c0=b.c, c1=b.c.replace(/,0\.35\)/,',0)');
      g.addColorStop(0,c0); g.addColorStop(1,c1);
      hctx.fillStyle=g; hctx.beginPath(); hctx.arc(b.x,b.y,b.r,0,Math.PI*2); hctx.fill();
    });
    requestAnimationFrame(tick);
  }
  window.addEventListener('resize', resizeHero, {passive:true});
  resizeHero(); tick();

  // 交互：跳转 pills
  document.querySelectorAll('.pill').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('.pill').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      document.querySelector(btn.dataset.jump)?.scrollIntoView({behavior:'smooth'});
    });
  });

  // 搜索过滤
  const q = document.getElementById('q');
  q.addEventListener('input', ()=>{
    const kw=(q.value||'').trim().toLowerCase();
    const list=GAMES.filter(g => [g.name,g.desc,(g.tags||[]).join(',')].join(' ').toLowerCase().includes(kw));
    ['learn','test'].forEach(k=>grids[k].innerHTML='');
    list.forEach((g)=>{
      const el=document.createElement('article'); el.className='card';
      el.innerHTML=`
        ${g.badges?.includes('NEW')?'<div class="badge">NEW</div>':''}
        <a class="thumb" href="${g.url}"><div class="inner"><canvas data-id="${g.id}"></canvas></div></a>
        <div class="name">${g.name}</div><div class="desc">${g.desc}</div>
        <div class="meta"><div>${(g.tags||[]).slice(0,3).map(t=>`<span class="tag">${t}</span>`).join('')}</div>
        <a class="go" href="${g.url}">开始</a></div>`;
      grids[g.group].appendChild(el); drawCover(el.querySelector('canvas'), g.id);
    });
  });

  render();

  // 兜底：如果有浏览器不尊重 z-index，再强制把徽标放到文档最后（仅在运行期克隆一次）
  // 可按需移除
  setTimeout(()=>{
    document.querySelectorAll('.card .badge').forEach(b=>{
      b.parentElement.appendChild(b); // move to the end to win stacking among siblings
    });
  },0);

  // 占位：未指定封面时的通用绘制
  function paintGeneric(ctx,w,h){ jellyBack(ctx,w,h); }
</script>
</body>
</html>
